<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aplikasi Seleksi Paskibras Sanpet 2025/2026</title>
  <script src="https://cdn.tailwindcss.com">
function simpanData() {
  const blob = new Blob([JSON.stringify(dataPeserta, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'data-sanpet-paskibras.json';
  a.click();
  URL.revokeObjectURL(url);
}

function muatData(event) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onload = function (e) {
    dataPeserta = JSON.parse(e.target.result);
    tampilkanData();
  };
  reader.readAsText(file);
}

</script>
  <script>
    // Enable dark mode class strategy
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {},
      },
      variants: {},
      plugins: [],
    };
  
function simpanData() {
  const blob = new Blob([JSON.stringify(dataPeserta, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'data-sanpet-paskibras.json';
  a.click();
  URL.revokeObjectURL(url);
}

function muatData(event) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onload = function (e) {
    dataPeserta = JSON.parse(e.target.result);
    tampilkanData();
  };
  reader.readAsText(file);
}

</script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-blue-50 to-white dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 min-h-screen flex items-center justify-center p-4 transition-colors duration-500">
  <div id="app" class="w-full max-w-6xl bg-white dark:bg-gray-900 rounded-xl shadow-lg overflow-hidden transition-colors duration-500">
    <!-- Dark/Light Mode Toggle -->
    <div class="flex justify-end p-4">
      <button id="toggle-theme-btn" aria-label="Toggle dark/light mode" title="Toggle dark/light mode" class="text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition text-xl focus:outline-none">
        <i id="theme-icon" class="fas fa-moon"></i>
      </button>
    </div>

    <!-- Login Page -->
    <section id="login-section" class="p-8 max-w-md mx-auto" >
      <h1 class="text-3xl font-semibold text-blue-700 dark:text-blue-400 mb-6 text-center">
        Aplikasi Seleksi Paskibras Sanpet 2025/2026
      </h1>
      <form id="login-form" class="space-y-6" novalidate>
        <div>
          <label for="accessCode" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Kode Akses</label>
          <input
            type="password"
            id="accessCode"
            name="accessCode"
            placeholder="Masukkan kode akses"
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-200 transition"
            required
            autocomplete="off"
          />
          <p id="login-error" class="text-red-600 mt-2 text-sm hidden"></p>
        </div>
        <button
          type="submit"
          class="w-full bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 text-white font-semibold py-3 rounded-lg transition"
        >
          Masuk
        </button>
      </form>
    </section>

    <!-- Main Page for Panitia -->
    <section id="main-section-panitia" class="hidden p-8 max-w-6xl mx-auto">
      <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
        <h2 class="text-2xl font-semibold text-blue-700 dark:text-blue-400 mb-4 sm:mb-0">
          Data Peserta Seleksi Paskibras
        </h2>
        <button
          id="logout-btn-panitia"
          class="flex items-center gap-2 text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-700 font-semibold transition"
          title="Keluar"
          aria-label="Keluar dari aplikasi"
        >
          <i class="fas fa-sign-out-alt"></i> Keluar
        </button>
      </header>

      <form id="participant-form" class="bg-blue-50 dark:bg-gray-800 p-6 rounded-lg shadow-md mb-8" novalidate>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
          <div>
            <label for="name" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Nama Peserta</label>
            <input
              type="text"
              id="name"
              name="name"
              placeholder="Masukkan nama lengkap"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-900 dark:text-gray-200 transition"
              required
              autocomplete="off"
            />
            <p class="text-red-600 mt-1 text-sm hidden" id="error-name"></p>
          </div>
          <div>
            <label for="class" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Kelas</label>
            <input
              type="text"
              id="class"
              name="class"
              placeholder="Contoh: 10 IPA 1"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-900 dark:text-gray-200 transition"
              required
              autocomplete="off"
            />
            <p class="text-red-600 mt-1 text-sm hidden" id="error-class"></p>
          </div>
          <div>
            <label for="scorePhysical" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Nilai Fisik</label>
            <input
              type="number"
              id="scorePhysical"
              name="scorePhysical"
              placeholder="0 - 100"
              min="0"
              max="100"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-900 dark:text-gray-200 transition"
              required
            />
            <p class="text-red-600 mt-1 text-sm hidden" id="error-physical"></p>
          </div>
          <div>
            <label for="scoreMarch" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Nilai Baris</label>
            <input
              type="number"
              id="scoreMarch"
              name="scoreMarch"
              placeholder="0 - 100"
              min="0"
              max="100"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-900 dark:text-gray-200 transition"
              required
            />
            <p class="text-red-600 mt-1 text-sm hidden" id="error-march"></p>
          </div>
          <div>
            <label for="scoreInterview" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Nilai Wawancara</label>
            <input
              type="number"
              id="scoreInterview"
              name="scoreInterview"
              placeholder="0 - 100"
              min="0"
              max="100"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-900 dark:text-gray-200 transition"
              required
            />
            <p class="text-red-600 mt-1 text-sm hidden" id="error-interview"></p>
          </div>
          <div class="flex items-end">
            <button
              type="submit"
              id="save-btn"
              class="w-full bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 text-white font-semibold py-3 rounded-lg transition"
            >
              Simpan Data
            </button>
          </div>
        </div>
      </form>

      <div class="overflow-x-auto rounded-lg shadow-md">
        <table class="min-w-full bg-white dark:bg-gray-800" aria-label="Tabel data peserta">
          <thead class="bg-blue-600 dark:bg-blue-700 text-white">
            <tr>
              <th scope="col" class="text-left py-3 px-4">No</th>
              <th scope="col" class="text-left py-3 px-4">Nama Peserta</th>
              <th scope="col" class="text-left py-3 px-4">Kelas</th>
              <th scope="col" class="text-center py-3 px-4">Nilai Fisik</th>
              <th scope="col" class="text-center py-3 px-4">Nilai Baris</th>
              <th scope="col" class="text-center py-3 px-4">Nilai Wawancara</th>
              <th scope="col" class="text-center py-3 px-4">Nilai Akhir</th>
              <th scope="col" class="text-center py-3 px-4">Status</th>
              <th scope="col" class="text-center py-3 px-4">Aksi</th>
            </tr>
          </thead>
          <tbody id="participants-table-body" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
        </table>

<!-- Tombol Simpan dan Muat Data -->
<div class="mt-6 flex gap-3">
  <button onclick="simpanData()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
    ðŸ’¾ Simpan Data
  </button>
  <input type="file" id="fileInput" class="hidden" accept=".json" onchange="muatData(event)" />
  <button onclick="document.getElementById('fileInput').click()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
    ðŸ“‚ Muat Data
  </button>
</div>

      </div>

      <div class="mt-6 flex flex-col sm:flex-row sm:justify-between gap-4">
        <button
          id="reset-btn"
          class="w-full sm:w-auto bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2"
        >
          <i class="fas fa-trash-alt"></i> Reset Semua Data
        </button>
        <div class="text-gray-600 dark:text-gray-400 text-sm sm:text-base self-center">
          &copy; 2025 Paskibras Sanpet
        </div>
      </div>
    </section>

    <!-- Main Page for Peserta -->
    <section id="main-section-peserta" class="hidden p-8 max-w-5xl mx-auto">
      <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
        <h2 class="text-2xl font-semibold text-blue-700 dark:text-blue-400 mb-4 sm:mb-0 text-center sm:text-left">
          Informasi Peserta Seleksi Paskibras
        </h2>
        <button
          id="logout-btn-peserta"
          class="flex items-center gap-2 text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-700 font-semibold transition self-center sm:self-auto"
          title="Keluar"
          aria-label="Keluar dari aplikasi"
        >
          <i class="fas fa-sign-out-alt"></i> Keluar
        </button>
      </header>

      <div class="overflow-x-auto rounded-lg shadow-md">
        <table class="min-w-full bg-white dark:bg-gray-800" aria-label="Tabel data peserta untuk peserta">
          <thead class="bg-blue-600 dark:bg-blue-700 text-white">
            <tr>
              <th scope="col" class="text-left py-3 px-4">No</th>
              <th scope="col" class="text-left py-3 px-4">Nama Peserta</th>
              <th scope="col" class="text-left py-3 px-4">Kelas</th>
              <th scope="col" class="text-center py-3 px-4">Nilai Fisik</th>
              <th scope="col" class="text-center py-3 px-4">Nilai Baris</th>
              <th scope="col" class="text-center py-3 px-4">Nilai Wawancara</th>
              <th scope="col" class="text-center py-3 px-4">Nilai Akhir</th>
              <th scope="col" class="text-center py-3 px-4">Status</th>
            </tr>
          </thead>
          <tbody id="participants-table-body-peserta" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
        </table>

<!-- Tombol Simpan dan Muat Data -->
<div class="mt-6 flex gap-3">
  <button onclick="simpanData()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
    ðŸ’¾ Simpan Data
  </button>
  <input type="file" id="fileInput" class="hidden" accept=".json" onchange="muatData(event)" />
  <button onclick="document.getElementById('fileInput').click()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
    ðŸ“‚ Muat Data
  </button>
</div>

      </div>

      <div class="mt-6 text-gray-600 dark:text-gray-400 text-sm sm:text-base text-center">
        &copy; 2025 Paskibras Sanpet
      </div>
    </section>
  </div>

  <script>
    (() => {
      const ACCESS_CODE_KEY = "paskibras_access_code";
      const USER_ROLE_KEY = "paskibras_user_role";
      const PARTICIPANTS_KEY = "paskibras_participants";
      const THEME_KEY = "paskibras_theme";

      // Access codes
      const ACCESS_CODES = {
        panitia: "panitia_paspet25/26",
        peserta: "pesertapaspet25/26",
      };

      // Elements
      const loginSection = document.getElementById("login-section");
      const mainSectionPanitia = document.getElementById("main-section-panitia");
      const mainSectionPeserta = document.getElementById("main-section-peserta");
      const loginForm = document.getElementById("login-form");
      const accessCodeInput = document.getElementById("accessCode");
      const loginError = document.getElementById("login-error");

      const logoutBtnPanitia = document.getElementById("logout-btn-panitia");
      const logoutBtnPeserta = document.getElementById("logout-btn-peserta");

      // Panitia elements
      const participantForm = document.getElementById("participant-form");
      const nameInput = document.getElementById("name");
      const classInput = document.getElementById("class");
      const scorePhysicalInput = document.getElementById("scorePhysical");
      const scoreMarchInput = document.getElementById("scoreMarch");
      const scoreInterviewInput = document.getElementById("scoreInterview");

      const errorName = document.getElementById("error-name");
      const errorClass = document.getElementById("error-class");
      const errorPhysical = document.getElementById("error-physical");
      const errorMarch = document.getElementById("error-march");
      const errorInterview = document.getElementById("error-interview");

      const participantsTableBody = document.getElementById("participants-table-body");
      const resetBtn = document.getElementById("reset-btn");

      // Peserta elements
      const participantsTableBodyPeserta = document.getElementById("participants-table-body-peserta");

      // Theme toggle elements
      const toggleThemeBtn = document.getElementById("toggle-theme-btn");
      const themeIcon = document.getElementById("theme-icon");

      let participants = [];
      let editIndex = -1;

      // Check login state on load
      function checkLogin() {
        const loggedInCode = localStorage.getItem(ACCESS_CODE_KEY);
        const userRole = localStorage.getItem(USER_ROLE_KEY);
        if (loggedInCode === ACCESS_CODES.panitia && userRole === "panitia") {
          showMainPanitia();
        } else if (loggedInCode === ACCESS_CODES.peserta && userRole === "peserta") {
          showMainPeserta();
        } else {
          showLogin();
        }
      }

      function showLogin() {
        loginSection.classList.remove("hidden");
        mainSectionPanitia.classList.add("hidden");
        mainSectionPeserta.classList.add("hidden");
        loginError.classList.add("hidden");
        accessCodeInput.value = "";
        accessCodeInput.focus();
      }

      function showMainPanitia() {
        loginSection.classList.add("hidden");
        mainSectionPanitia.classList.remove("hidden");
        mainSectionPeserta.classList.add("hidden");
        loadParticipants();
        renderTablePanitia();
        resetForm();
      }

      function showMainPeserta() {
        loginSection.classList.add("hidden");
        mainSectionPanitia.classList.add("hidden");
        mainSectionPeserta.classList.remove("hidden");
        loadParticipants();
        renderTablePeserta();
      }

      // Login form submit
      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const code = accessCodeInput.value.trim();
        if (code === ACCESS_CODES.panitia) {
          localStorage.setItem(ACCESS_CODE_KEY, code);
          localStorage.setItem(USER_ROLE_KEY, "panitia");
          showMainPanitia();
        } else if (code === ACCESS_CODES.peserta) {
          localStorage.setItem(ACCESS_CODE_KEY, code);
          localStorage.setItem(USER_ROLE_KEY, "peserta");
          showMainPeserta();
        } else {
          loginError.textContent = "Kode akses salah. Silakan coba lagi.";
          loginError.classList.remove("hidden");
          accessCodeInput.focus();
        }
      });

      // Logout buttons
      logoutBtnPanitia.addEventListener("click", () => {
        localStorage.removeItem(ACCESS_CODE_KEY);
        localStorage.removeItem(USER_ROLE_KEY);
        showLogin();
      });
      logoutBtnPeserta.addEventListener("click", () => {
        localStorage.removeItem(ACCESS_CODE_KEY);
        localStorage.removeItem(USER_ROLE_KEY);
        showLogin();
      });

      // Load participants from localStorage
      function loadParticipants() {
        const data = localStorage.getItem(PARTICIPANTS_KEY);
        if (data) {
          try {
            participants = JSON.parse(data);
          } catch {
            participants = [];
          }
        } else {
          participants = [];
        }
      }

      // Save participants to localStorage
      function saveParticipants() {
        localStorage.setItem(PARTICIPANTS_KEY, JSON.stringify(participants));
      }

      // Calculate total score and assign status
      function processParticipants() {
        // Calculate total score for each participant
        participants.forEach(p => {
          p.totalScore = p.scorePhysical + p.scoreMarch + p.scoreInterview;
        });
        // Sort descending by totalScore
        participants.sort((a, b) => b.totalScore - a.totalScore);

        // Assign status based on rank
        participants.forEach((p, i) => {
          if (i < 24) {
            p.status = "Lulus";
          } else if (i >= 24 && i < 27) {
            p.status = "Cadangan";
          } else {
            p.status = "Tidak Lulus";
          }
        });
      }

      // Render participants table for Panitia
      function renderTablePanitia() {
        processParticipants();
        participantsTableBody.innerHTML = "";
        if (participants.length === 0) {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.setAttribute("colspan", "9");
          td.className = "text-center py-6 text-gray-500 dark:text-gray-400 italic";
          td.textContent = "Belum ada data peserta.";
          tr.appendChild(td);
          participantsTableBody.appendChild(tr);
          return;
        }
        participants.forEach((p, i) => {
          const tr = document.createElement("tr");
          tr.className = "hover:bg-blue-50 dark:hover:bg-gray-700 transition";

          const tdNo = document.createElement("td");
          tdNo.className = "py-3 px-4";
          tdNo.textContent = i + 1;
          tr.appendChild(tdNo);

          const tdName = document.createElement("td");
          tdName.className = "py-3 px-4 dark:text-gray-200";
          tdName.textContent = p.name;
          tr.appendChild(tdName);

          const tdClass = document.createElement("td");
          tdClass.className = "py-3 px-4 dark:text-gray-200";
          tdClass.textContent = p.class;
          tr.appendChild(tdClass);

          const tdPhysical = document.createElement("td");
          tdPhysical.className = "py-3 px-4 text-center dark:text-gray-200";
          tdPhysical.textContent = p.scorePhysical;
          tr.appendChild(tdPhysical);

          const tdMarch = document.createElement("td");
          tdMarch.className = "py-3 px-4 text-center dark:text-gray-200";
          tdMarch.textContent = p.scoreMarch;
          tr.appendChild(tdMarch);

          const tdInterview = document.createElement("td");
          tdInterview.className = "py-3 px-4 text-center dark:text-gray-200";
          tdInterview.textContent = p.scoreInterview;
          tr.appendChild(tdInterview);

          const tdTotal = document.createElement("td");
          tdTotal.className = "py-3 px-4 text-center font-semibold dark:text-gray-200";
          tdTotal.textContent = p.totalScore;
          tr.appendChild(tdTotal);

          const tdStatus = document.createElement("td");
          tdStatus.className = "py-3 px-4 text-center font-semibold";
          if (p.status === "Lulus") {
            tdStatus.innerHTML = '<span class="text-green-700 bg-green-100 dark:bg-green-900 dark:text-green-300 px-2 py-1 rounded-full">Lulus</span>';
          } else if (p.status === "Cadangan") {
            tdStatus.innerHTML = '<span class="text-yellow-700 bg-yellow-100 dark:bg-yellow-900 dark:text-yellow-300 px-2 py-1 rounded-full">Cadangan</span>';
          } else {
            tdStatus.innerHTML = '<span class="text-red-700 bg-red-100 dark:bg-red-900 dark:text-red-300 px-2 py-1 rounded-full">Tidak Lulus</span>';
          }
          tr.appendChild(tdStatus);

          const tdActions = document.createElement("td");
          tdActions.className = "py-3 px-4 text-center flex justify-center gap-3";

          const editBtn = document.createElement("button");
          editBtn.className = "text-yellow-600 hover:text-yellow-800 dark:text-yellow-400 dark:hover:text-yellow-300 transition";
          editBtn.setAttribute("aria-label", `Edit data peserta ${p.name}`);
          editBtn.innerHTML = '<i class="fas fa-edit"></i>';
          editBtn.addEventListener("click", () => {
            startEdit(i);
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-700 transition";
          deleteBtn.setAttribute("aria-label", `Hapus data peserta ${p.name}`);
          deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
          deleteBtn.addEventListener("click", () => {
            deleteParticipant(i);
          });

          tdActions.appendChild(editBtn);
          tdActions.appendChild(deleteBtn);
          tr.appendChild(tdActions);

          participantsTableBody.appendChild(tr);
        });
      }

      // Render participants table for Peserta (read-only)
      function renderTablePeserta() {
        processParticipants();
        participantsTableBodyPeserta.innerHTML = "";
        if (participants.length === 0) {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.setAttribute("colspan", "8");
          td.className = "text-center py-6 text-gray-500 dark:text-gray-400 italic";
          td.textContent = "Belum ada data peserta.";
          tr.appendChild(td);
          participantsTableBodyPeserta.appendChild(tr);
          return;
        }
        participants.forEach((p, i) => {
          const tr = document.createElement("tr");
          tr.className = "hover:bg-blue-50 dark:hover:bg-gray-700 transition";

          const tdNo = document.createElement("td");
          tdNo.className = "py-3 px-4 dark:text-gray-200";
          tdNo.textContent = i + 1;
          tr.appendChild(tdNo);

          const tdName = document.createElement("td");
          tdName.className = "py-3 px-4 dark:text-gray-200";
          tdName.textContent = p.name;
          tr.appendChild(tdName);

          const tdClass = document.createElement("td");
          tdClass.className = "py-3 px-4 dark:text-gray-200";
          tdClass.textContent = p.class;
          tr.appendChild(tdClass);

          const tdPhysical = document.createElement("td");
          tdPhysical.className = "py-3 px-4 text-center dark:text-gray-200";
          tdPhysical.textContent = p.scorePhysical;
          tr.appendChild(tdPhysical);

          const tdMarch = document.createElement("td");
          tdMarch.className = "py-3 px-4 text-center dark:text-gray-200";
          tdMarch.textContent = p.scoreMarch;
          tr.appendChild(tdMarch);

          const tdInterview = document.createElement("td");
          tdInterview.className = "py-3 px-4 text-center dark:text-gray-200";
          tdInterview.textContent = p.scoreInterview;
          tr.appendChild(tdInterview);

          const tdTotal = document.createElement("td");
          tdTotal.className = "py-3 px-4 text-center font-semibold dark:text-gray-200";
          tdTotal.textContent = p.totalScore;
          tr.appendChild(tdTotal);

          const tdStatus = document.createElement("td");
          tdStatus.className = "py-3 px-4 text-center font-semibold";
          if (p.status === "Lulus") {
            tdStatus.innerHTML = '<span class="text-green-700 bg-green-100 dark:bg-green-900 dark:text-green-300 px-2 py-1 rounded-full">Lulus</span>';
          } else if (p.status === "Cadangan") {
            tdStatus.innerHTML = '<span class="text-yellow-700 bg-yellow-100 dark:bg-yellow-900 dark:text-yellow-300 px-2 py-1 rounded-full">Cadangan</span>';
          } else {
            tdStatus.innerHTML = '<span class="text-red-700 bg-red-100 dark:bg-red-900 dark:text-red-300 px-2 py-1 rounded-full">Tidak Lulus</span>';
          }
          tr.appendChild(tdStatus);

          participantsTableBodyPeserta.appendChild(tr);
        });
      }

      // Reset form and errors
      function resetForm() {
        participantForm.reset();
        editIndex = -1;
        clearErrors();
        document.getElementById("save-btn").textContent = "Simpan Data";
      }

      // Clear all error messages
      function clearErrors() {
        errorName.textContent = "";
        errorName.classList.add("hidden");
        errorClass.textContent = "";
        errorClass.classList.add("hidden");
        errorPhysical.textContent = "";
        errorPhysical.classList.add("hidden");
        errorMarch.textContent = "";
        errorMarch.classList.add("hidden");
        errorInterview.textContent = "";
        errorInterview.classList.add("hidden");
      }

      // Validate form inputs
      function validateForm() {
        let valid = true;
        clearErrors();

        if (!nameInput.value.trim()) {
          errorName.textContent = "Nama peserta wajib diisi.";
          errorName.classList.remove("hidden");
          valid = false;
        }
        if (!classInput.value.trim()) {
          errorClass.textContent = "Kelas wajib diisi.";
          errorClass.classList.remove("hidden");
          valid = false;
        }
        const physical = Number(scorePhysicalInput.value);
        if (isNaN(physical) || physical < 0 || physical > 100) {
          errorPhysical.textContent = "Nilai fisik harus antara 0 dan 100.";
          errorPhysical.classList.remove("hidden");
          valid = false;
        }
        const march = Number(scoreMarchInput.value);
        if (isNaN(march) || march < 0 || march > 100) {
          errorMarch.textContent = "Nilai baris harus antara 0 dan 100.";
          errorMarch.classList.remove("hidden");
          valid = false;
        }
        const interview = Number(scoreInterviewInput.value);
        if (isNaN(interview) || interview < 0 || interview > 100) {
          errorInterview.textContent = "Nilai wawancara harus antara 0 dan 100.";
          errorInterview.classList.remove("hidden");
          valid = false;
        }
        return valid;
      }

      // Add or update participant
      participantForm.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!validateForm()) return;

        const participantData = {
          name: nameInput.value.trim(),
          class: classInput.value.trim(),
          scorePhysical: Number(scorePhysicalInput.value),
          scoreMarch: Number(scoreMarchInput.value),
          scoreInterview: Number(scoreInterviewInput.value),
        };

        if (editIndex === -1) {
          participants.push(participantData);
        } else {
          participants[editIndex] = participantData;
        }
        saveParticipants();
        renderTablePanitia();
        resetForm();
      });

      // Start editing a participant
      function startEdit(index) {
        // Because participants are sorted in render, find original participant by index in sorted array
        const sortedParticipants = [...participants];
        sortedParticipants.forEach(p => {
          p.totalScore = p.scorePhysical + p.scoreMarch + p.scoreInterview;
        });
        sortedParticipants.sort((a, b) => b.totalScore - a.totalScore);
        sortedParticipants.forEach((p, i) => {
          p.status = i < 24 ? "Lulus" : i < 27 ? "Cadangan" : "Tidak Lulus";
          p.originalIndex = participants.indexOf(p);
        });
        const p = sortedParticipants[index];
        if (!p) return;
        editIndex = p.originalIndex;
        nameInput.value = p.name;
        classInput.value = p.class;
        scorePhysicalInput.value = p.scorePhysical;
        scoreMarchInput.value = p.scoreMarch;
        scoreInterviewInput.value = p.scoreInterview;
        clearErrors();
        document.getElementById("save-btn").textContent = "Perbarui Data";
        nameInput.focus();
      }

      // Delete participant
      function deleteParticipant(index) {
        const sortedParticipants = [...participants];
        sortedParticipants.forEach(p => {
          p.totalScore = p.scorePhysical + p.scoreMarch + p.scoreInterview;
        });
        sortedParticipants.sort((a, b) => b.totalScore - a.totalScore);
        sortedParticipants.forEach((p, i) => {
          p.status = i < 24 ? "Lulus" : i < 27 ? "Cadangan" : "Tidak Lulus";
          p.originalIndex = participants.indexOf(p);
        });
        const p = sortedParticipants[index];
        if (!p) return;
        if (confirm(`Apakah Anda yakin ingin menghapus data peserta "${p.name}"?`)) {
          participants.splice(p.originalIndex, 1);
          saveParticipants();
          renderTablePanitia();
          resetForm();
        }
      }

      // Reset all data
      resetBtn.addEventListener("click", () => {
        if (confirm("Apakah Anda yakin ingin menghapus semua data peserta?")) {
          participants = [];
          saveParticipants();
          renderTablePanitia();
          resetForm();
        }
      });

      // Theme toggle logic
      function applyTheme(theme) {
        if (theme === "dark") {
          document.documentElement.classList.add("dark");
          themeIcon.classList.remove("fa-moon");
          themeIcon.classList.add("fa-sun");
        } else {
          document.documentElement.classList.remove("dark");
          themeIcon.classList.remove("fa-sun");
          themeIcon.classList.add("fa-moon");
        }
      }

      function loadTheme() {
        const savedTheme = localStorage.getItem(THEME_KEY);
        if (savedTheme) {
          applyTheme(savedTheme);
        } else {
          // Default to system preference
          const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
          applyTheme(prefersDark ? "dark" : "light");
        }
      }

      toggleThemeBtn.addEventListener("click", () => {
        const isDark = document.documentElement.classList.contains("dark");
        if (isDark) {
          applyTheme("light");
          localStorage.setItem(THEME_KEY, "light");
        } else {
          applyTheme("dark");
          localStorage.setItem(THEME_KEY, "dark");
        }
      });

      // Initialize app
      loadTheme();
      checkLogin();
    })();
  
function simpanData() {
  const blob = new Blob([JSON.stringify(dataPeserta, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'data-sanpet-paskibras.json';
  a.click();
  URL.revokeObjectURL(url);
}

function muatData(event) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onload = function (e) {
    dataPeserta = JSON.parse(e.target.result);
    tampilkanData();
  };
  reader.readAsText(file);
}

</script>
</body>
</html>